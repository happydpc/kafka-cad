syntax = "proto3";

package object_state;

//This defines the types that get pushed to the ObjectState Kafka topic.

message Point3Msg {
    double x = 1;
    double y = 2;
    double z = 3;
}

message OptionPoint3Msg {
    Point3Msg pt = 1;
}

message LineMsg {
    Point3Msg first = 1;
    Point3Msg second = 2;
}

message OptionLineMsg {
    LineMsg line = 1;
}

message PlaneMsg {
    Point3Msg first = 1;
    Point3Msg second = 2;
    Point3Msg third = 3;
}

message OptionPlaneMsg {
    PlaneMsg plane = 1;
}

message ProfileMsg {
    repeated OptionPoint3Msg points = 1;
    repeated OptionLineMsg lines = 2;
    repeated OptionPlaneMsg planes = 3;
}

message AxisAlignedBBoxMsg {
    Point3Msg bottom_left = 1;
    Point3Msg top_right = 2;
}

message PropertyMsg {
    string key = 1;
    string value = 2;
}

message PropertiesMsg {
    repeated PropertyMsg properties  =1;
}

message ResultsMsg {
    bool visible = 1;
    ProfileMsg profile = 2;
    AxisAlignedBBoxMsg bbox = 3;
    PropertiesMsg properties = 4;
}

message RefIDMsg {
    string id = 1;
    enum RefType {
        EXISTENCE = 0;
        VISIBILITY = 1;
        AXIS_ALIGNED_BBOX = 2;
        PROFILE_POINT = 3;
        PROFILE_LINE = 4;
        PROFILE_PLANE = 5;
        PROPERTY = 6;
    }
    RefType ref_type = 2;
    uint64 index = 3;
}

message ReferenceMsg {
    RefIDMsg owner = 1;
    RefIDMsg other = 2;
}

message OptionReferenceMsg {
    ReferenceMsg reference = 1;
}

message DependenciesMsg {
    repeated OptionReferenceMsg references = 1;
}

message ObjectMsg {
    DependenciesMsg dependencies = 1;
    ResultsMsg results = 2;
    bytes obj_data = 3;
}

//This is the fundamental message sent to the ObjectState topic.
message ChangeMsg {
    string id = 1;
    enum ChangeType {
        ADD = 0;
        MODIFY = 1;
        DELETE = 2;
    }
    ChangeType change_type = 2;
    ObjectMsg object = 3;
}