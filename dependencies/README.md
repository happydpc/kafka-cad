# dependencies

This service caches the state of the dependency graph.  The dependency graph consists of a map of RefID -> Set<RefID>.  A RefID is the address of a specific piece of information on an object.  When that information changes, the set of RefIDs that are subscribed to that publisher need to be notified.  This service produces the set of RefIDs that must be notified when a set of RefIDs changes.
The complicated part is that we need to have versions of the dependency graph at different offsets.  We don't need all offsets, just the last five or so to allow for race conditions.  So really, we have to make our map RefID -> [(Offset, Set<RefID>), (Offset, Set<RefID>)].  When a set of changes comes in, we look at all the publishers those changed objects are subscribed to.  We pull their latest subscriber sets.  We then see if we've added or deleted any subs from that set with this change.  If we have, we modify the set and put it back in as a new entry in the list with a new offset.
When traversing the map in a breadth-first-search, we also have a specified offset that the caller is on.  We get the latest subscriber set that's less than or equal to that offset, then add it to our traversal set.  
Now for detecting adds and deletes.  We can cache the previous version of the object's dependencies.  If that object's dependencies haven't changed, don't bother pulling and changing any subscriber sets.    